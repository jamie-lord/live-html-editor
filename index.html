<!DOCTYPE html>
<html lang="en">

<head>
    <title>Live HTML editor</title>

    <style>
        .flex-container {
            display: flex;
            flex-direction: row;
        }

        .flex-left {
            width: 25%;
            height: 100vh;
            margin: 5px;
            padding: 5px;
            border: 2px solid red;
        }

        .flex-right {
            width: 75%;
            margin: 5px;
            padding: 5px;
            border: 2px solid green;
        }
    </style>

    <script>
        const html = `
        <!DOCTYPE html>
<html lang="en">
<head>
    <title>Example page</title>
</head>
<body>
<h1>This is only a test</h1>
<p >Hello there!</p>
<a href="https://news.ycombinator.com/news">Hacker News</a> 
</body>
</html>`;

        let _selectedElementPropertiesList;
        let _selectedElementChildrenList;
        let _selectedElement;
        let _selectedElementObserver;
        let _selectedElementOriginalBackgroundImage;

        function init() {
            _selectedElementPropertiesList = document.getElementById("selected-element-properties-list");
            _selectedElementChildrenList = document.getElementById("selected-element-children-list");
            let iframe = document.getElementById("content-frame");
            // Load content into iframe
            iframe.contentWindow.document.write(html);
            // Make content editable
            const rootElement = iframe.contentDocument.documentElement;
            rootElement.setAttribute("contenteditable", "true");
            iframe.contentDocument.addEventListener("click", (event) => {
                setSelectedElement(event.target);
            });
        }

        function setSelectedElement(element) {
            removeSelectedElementHighlight();
            if (_selectedElementObserver) {
                _selectedElementObserver.disconnect();
            }

            _selectedElement = element;
            highlightSelectedElement();
            if (_selectedElement.parentElement) {
                document.getElementById("goto-parent-button").disabled = false;
            } else {
                document.getElementById("goto-parent-button").disabled = true;
            }

            // Watch for changes
            _selectedElementObserver = new MutationObserver((records, observer) => {
                console.log(records);
                updateSelectedElementProperties();
            });
            const config = { attributes: true, childList: true, subtree: true, characterData: true };
            _selectedElementObserver.observe(_selectedElement, config);

            updateSelectedElementProperties();
        }

        function updateSelectedElementProperties() {
            const activeElementId = document.activeElement.id;

            document.getElementById("selected-element-name").textContent = _selectedElement.tagName;
            // remove all children from properties list
            while (_selectedElementPropertiesList.lastChild) {
                _selectedElementPropertiesList.removeChild(_selectedElementPropertiesList.lastChild);
            }

            // Remove all children from the children list
            while (_selectedElementChildrenList.lastChild) {
                _selectedElementChildrenList.removeChild(_selectedElementChildrenList.lastChild);
            }

            addAttributeToPropertiesList(_selectedElement, "textContent", _selectedElement.textContent, "textContent");

            for (let i = 0; i < _selectedElement.attributes.length; i++) {
                const attribute = _selectedElement.attributes.item(i);
                addAttributeToPropertiesList(_selectedElement, attribute.name, attribute.value, i);
            }

            // List children
            if (_selectedElement.children.length === 0) {
                const li = document.createElement("li");
                li.textContent = "Selected element has no children";
                _selectedElementChildrenList.appendChild(li);
            } else {
                for (let i = 0; i < _selectedElement.children.length; i++) {
                    const child = _selectedElement.children[i];
                    addChildToChildrenList(child);
                }
            }

            if (activeElementId) {
                document.getElementById(activeElementId).focus();
            }
        }

        function highlightSelectedElement() {
            _selectedElementOriginalBackgroundImage = _selectedElement.style.backgroundImage;
            _selectedElement.style.backgroundImage = `linear-gradient(90deg, hsl(0deg 100% 54%) 0%, hsl(282deg 100% 52%) 50%, hsl(203deg 100% 50%) 100%)`;
        }

        function removeSelectedElementHighlight() {
            if (!_selectedElement) {
                return;
            }
            _selectedElement.style.backgroundImage = _selectedElementOriginalBackgroundImage;
            if (_selectedElement.style === "" || _selectedElement.style.length === 0) {
                _selectedElement.removeAttribute("style");
            }
        }

        function addAttributeToPropertiesList(element, attributeName, attributeValue, id) {
            const li = document.createElement("li");
            const label = document.createElement("label");
            label.textContent = attributeName;
            const input = document.createElement("input");
            input.id = `property_input_${id}`;
            input.type = "text";
            input.value = attributeValue;
            input.addEventListener("input", (valInput) => {
                // Update the content value
                if (attributeName === "textContent") {
                    element.textContent = valInput.target.value;
                } else {
                    element.setAttribute(attributeName, valInput.target.value);
                }
            });

            li.appendChild(label);
            li.appendChild(input);
            _selectedElementPropertiesList.appendChild(li);
        }

        function addAttribute() {
            const nameInput = document.getElementById("attribute-name-input");
            const valueInput = document.getElementById("attribute-value-input");
            _selectedElement.setAttribute(nameInput.value, valueInput.value);
            nameInput.value = null;
            valueInput.value = null;
        }

        function addChildToChildrenList(element) {
            const li = document.createElement("li");
            li.textContent = element.tagName;
            li.addEventListener("click", (event) => {
                setSelectedElement(element);
            });
            _selectedElementChildrenList.appendChild(li);
        }

        function gotoParent() {
            setSelectedElement(_selectedElement.parentElement);
        }

        function addChild() {
            const childTagNameInput = document.getElementById("new-child-element-tag-name-input");
            const child = document.createElement(childTagNameInput.value);
            _selectedElement.appendChild(child);
            setSelectedElement(child);
            childTagNameInput.value = null;
        }

        window.onload = init;
    </script>
</head>

<body>
    <div class="flex-container">
        <div class="flex-left">
            <h1 id="selected-element-name">No element selected</h1>
            <ul id="selected-element-properties-list"></ul>

            <label for="attribute-name">Attribute name</label>
            <input type="text" id="attribute-name-input" name="attribute-name">
            <label for="attribute-value">Attribute value</label>
            <input type="text" id="attribute-value-input" name="attribute-value">
            <button onclick="addAttribute()">Add attribute</button>

            <h1>Children</h1>
            <ul id="selected-element-children-list"></ul>
            <button id="goto-parent-button" onclick="gotoParent()" disabled>Goto parent</button>

            <h2>Add new child</h2>
            <label for="new-child-element-tag-name">Child tag name</label>
            <input type="text" id="new-child-element-tag-name-input" name="new-child-element-tag-name">
            <button onclick="addChild()">Add child</button>
        </div>
        <iframe class="flex-right" id="content-frame"></iframe>
    </div>
</body>

</html>